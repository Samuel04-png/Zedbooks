import{z as le,u as te,r as oe,A as O,b as z,d as J,G as Y,H as k,J as I,K as G,M as ce,j as e,k as ie,I as de,f as j,g as b,h as g,i as y,N as c,T as he,l as me,m as A,p as v,B as M,D as T,q as R,s as D,t as f,v as i,w as _,x as o,F as xe,O as U,P as $}from"./index-Dx-svpV5.js";const pe=E=>{if(!E)return null;const h=new Date(String(E));return Number.isNaN(h.getTime())?null:h.toISOString().slice(0,10)},ue=(E,h)=>{if(!E.length)return[];const x=[];for(let S=0;S<E.length;S+=h)x.push(E.slice(S,S+h));return x};function ye(){const E=le(),{user:h}=te(),[x,S]=oe.useState(O(new Date,"yyyy-MM")),Q=`${x}-01`,W=new Date(parseInt(x.split("-")[0],10),parseInt(x.split("-")[1],10),0).toISOString().split("T")[0],{data:w,isLoading:Z}=z({queryKey:["payroll-runs-report",x,h==null?void 0:h.id],queryFn:async()=>{if(!h)return[];const s=await J.getPrimaryMembershipByUser(h.id);if(!(s!=null&&s.companyId))return[];const l=Y($,U.PAYROLL_RUNS);return(await k(I(l,G("companyId","==",s.companyId)))).docs.map(m=>{const d=m.data(),N=d.runDate??d.run_date;return{id:m.id,runDate:N?String(N):""}}).filter(m=>{const d=pe(m.runDate);return!!(d&&d>=Q&&d<=W)}).sort((m,d)=>String(d.runDate).localeCompare(String(m.runDate)))},enabled:!!h}),{data:a}=z({queryKey:["payroll-items-report",x,h==null?void 0:h.id,(w||[]).map(s=>s.id).join("|")],queryFn:async()=>{if(!h||!w||w.length===0)return[];const s=await J.getPrimaryMembershipByUser(h.id);if(!(s!=null&&s.companyId))return[];const l=new Set(w.map(p=>p.id)),n=Y($,U.PAYROLL_ITEMS),m=(await k(I(n,G("companyId","==",s.companyId)))).docs.map(p=>{const t=p.data();return{id:p.id,payrollRunId:String(t.payrollRunId??t.payroll_run_id??""),employeeId:String(t.employeeId??t.employee_id??""),basicSalary:Number(t.basicSalary??t.basic_salary??0),housingAllowance:Number(t.housingAllowance??t.housing_allowance??0),transportAllowance:Number(t.transportAllowance??t.transport_allowance??0),otherAllowances:Number(t.otherAllowances??t.other_allowances??0),grossSalary:Number(t.grossSalary??t.gross_salary??0),paye:Number(t.paye??0),napsaEmployee:Number(t.napsaEmployee??t.napsa_employee??0),napsaEmployer:Number(t.napsaEmployer??t.napsa_employer??0),nhimaEmployee:Number(t.nhimaEmployee??t.nhima_employee??0),nhimaEmployer:Number(t.nhimaEmployer??t.nhima_employer??0),advancesDeducted:Number(t.advancesDeducted??t.advances_deducted??0),totalDeductions:Number(t.totalDeductions??t.total_deductions??0),netSalary:Number(t.netSalary??t.net_salary??0)}}).filter(p=>p.payrollRunId&&l.has(p.payrollRunId)),d=Array.from(new Set(m.map(p=>p.employeeId).filter(Boolean))),N=new Map,C=ue(d,30);if(C.length>0){const p=Y($,U.EMPLOYEES);(await Promise.all(C.map(H=>k(I(p,G(ce(),"in",H)))))).forEach(H=>{H.docs.forEach(K=>{const u=K.data();N.set(K.id,{fullName:String(u.fullName??u.full_name??""),employeeNumber:String(u.employeeNumber??u.employee_number??""),tpin:String(u.tpin??""),napsaNumber:String(u.napsaNumber??u.napsa_number??""),nhimaNumber:String(u.nhimaNumber??u.nhima_number??""),position:String(u.position??""),department:String(u.department??"")})})})}return m.map(p=>({...p,employees:N.get(p.employeeId)??null}))},enabled:!!(h&&w&&w.length>0)}),P=(s,l,n)=>{const r=[s,...l].map(C=>C.join(",")).join(`
`),m=new Blob([r],{type:"text/csv"}),d=window.URL.createObjectURL(m),N=document.createElement("a");N.href=d,N.download=n,N.click(),window.URL.revokeObjectURL(d)},X=()=>{if(!a||a.length===0)return;const s=["Employee Number","Employee Name","Position","Department","Basic Salary","Housing Allowance","Transport Allowance","Other Allowances","Gross Salary","PAYE","NAPSA Employee","NHIMA Employee","Advances Deducted","Total Deductions","Net Salary"],l=a.map(n=>{const r=n.employees;return[(r==null?void 0:r.employeeNumber)??"",(r==null?void 0:r.fullName)??"",(r==null?void 0:r.position)||"",(r==null?void 0:r.department)||"",n.basicSalary,n.housingAllowance,n.transportAllowance,n.otherAllowances,n.grossSalary,n.paye,n.napsaEmployee,n.nhimaEmployee,n.advancesDeducted,n.totalDeductions,n.netSalary]});P(s,l,`master-payroll-${x}.csv`)},ee=()=>{if(!a||a.length===0)return;const s=["Employee Number","Employee Name","NAPSA Number","Gross Salary","Employee Contribution (5%)","Employer Contribution (5%)","Total Contribution"],l=a.map(n=>{const r=n.employees,m=n.napsaEmployee,d=n.napsaEmployer;return[(r==null?void 0:r.employeeNumber)??"",(r==null?void 0:r.fullName)??"",(r==null?void 0:r.napsaNumber)||"",n.grossSalary,m,d,m+d]});P(s,l,`napsa-report-${x}.csv`)},se=()=>{if(!a||a.length===0)return;const s=["Employee Number","Employee Name","NHIMA Number","Basic Salary","Employee Contribution (1%)","Employer Contribution (1%)","Total Contribution"],l=a.map(n=>{const r=n.employees,m=n.nhimaEmployee,d=n.nhimaEmployer;return[(r==null?void 0:r.employeeNumber)??"",(r==null?void 0:r.fullName)??"",(r==null?void 0:r.nhimaNumber)||"",n.basicSalary,m,d,m+d]});P(s,l,`nhima-report-${x}.csv`)},ae=()=>{if(!a||a.length===0)return;const s=["Employee Number","Employee Name","TPIN","Gross Salary","PAYE Amount"],l=a.map(n=>{const r=n.employees;return[(r==null?void 0:r.employeeNumber)??"",(r==null?void 0:r.fullName)??"",(r==null?void 0:r.tpin)||"",n.grossSalary,n.paye]});P(s,l,`paye-report-${x}.csv`)},re=(a==null?void 0:a.reduce((s,l)=>s+l.grossSalary,0))||0,ne=(a==null?void 0:a.reduce((s,l)=>s+l.netSalary,0))||0,q=(a==null?void 0:a.reduce((s,l)=>s+l.paye,0))||0,L=(a==null?void 0:a.reduce((s,l)=>s+l.napsaEmployee,0))||0,B=(a==null?void 0:a.reduce((s,l)=>s+l.napsaEmployer,0))||0,V=(a==null?void 0:a.reduce((s,l)=>s+l.nhimaEmployee,0))||0,F=(a==null?void 0:a.reduce((s,l)=>s+l.nhimaEmployer,0))||0;return Z?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Payroll Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive payroll analysis and statutory reports"})]})}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"w-48",children:[e.jsx(ie,{children:"Select Month"}),e.jsx(de,{type:"month",value:x,onChange:s=>S(s.target.value)})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(j,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Total Gross"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:c(re)})})]}),e.jsxs(j,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Total PAYE"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:c(q)})})]}),e.jsxs(j,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Total NAPSA"})}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c(L+B)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Employee + Employer"})]})]}),e.jsxs(j,{children:[e.jsx(b,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Total Net Pay"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:c(ne)})})]})]}),e.jsxs(he,{defaultValue:"master",className:"space-y-4",children:[e.jsxs(me,{children:[e.jsx(A,{value:"master",children:"Master Payroll"}),e.jsx(A,{value:"payslips",children:"Individual Payslips"}),e.jsx(A,{value:"napsa",children:"NAPSA Report"}),e.jsx(A,{value:"nhima",children:"NHIMA Report"}),e.jsx(A,{value:"paye",children:"PAYE Report"})]}),e.jsx(v,{value:"master",children:e.jsxs(j,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs(g,{children:["Master Payroll - ",O(new Date(x+"-01"),"MMMM yyyy")]}),e.jsxs(M,{onClick:X,disabled:!(a!=null&&a.length),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]}),e.jsx(y,{children:e.jsxs(R,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Emp #"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Position"}),e.jsx(i,{className:"text-right",children:"Basic"}),e.jsx(i,{className:"text-right",children:"Gross"}),e.jsx(i,{className:"text-right",children:"Deductions"}),e.jsx(i,{className:"text-right",children:"Net Pay"})]})}),e.jsxs(_,{children:[a==null?void 0:a.map(s=>{var l,n,r;return e.jsxs(f,{children:[e.jsx(o,{children:(l=s.employees)==null?void 0:l.employeeNumber}),e.jsx(o,{children:(n=s.employees)==null?void 0:n.fullName}),e.jsx(o,{children:((r=s.employees)==null?void 0:r.position)||"-"}),e.jsx(o,{className:"text-right",children:c(s.basicSalary)}),e.jsx(o,{className:"text-right",children:c(s.grossSalary)}),e.jsx(o,{className:"text-right",children:c(s.totalDeductions)}),e.jsx(o,{className:"text-right font-semibold",children:c(s.netSalary)})]},s.id)}),(!a||a.length===0)&&e.jsx(f,{children:e.jsx(o,{colSpan:7,className:"text-center text-muted-foreground",children:"No payroll data for selected month"})})]})]})})]})}),e.jsx(v,{value:"payslips",children:e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs(g,{children:["Individual Payslips - ",O(new Date(x+"-01"),"MMMM yyyy")]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[a==null?void 0:a.map(s=>{var l,n;return e.jsx(j,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>E(`/payroll/${s.payrollRunId}/payslip/${s.employeeId}`),children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(l=s.employees)==null?void 0:l.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(n=s.employees)==null?void 0:n.employeeNumber})]}),e.jsx(xe,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Net Pay"}),e.jsx("p",{className:"text-lg font-bold",children:c(s.netSalary)})]})]})},s.id)}),(!a||a.length===0)&&e.jsx("p",{className:"text-muted-foreground col-span-full text-center py-8",children:"No payroll data for selected month"})]})})]})}),e.jsx(v,{value:"napsa",children:e.jsxs(j,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"NAPSA Contributions Report"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",c(L+B)," (Employee: ",c(L)," + Employer: ",c(B),")"]})]}),e.jsxs(M,{onClick:ee,disabled:!(a!=null&&a.length),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]}),e.jsx(y,{children:e.jsxs(R,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Emp #"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"NAPSA Number"}),e.jsx(i,{className:"text-right",children:"Gross Salary"}),e.jsx(i,{className:"text-right",children:"Employee (5%)"}),e.jsx(i,{className:"text-right",children:"Employer (5%)"}),e.jsx(i,{className:"text-right",children:"Total"})]})}),e.jsx(_,{children:a==null?void 0:a.map(s=>{var l,n,r;return e.jsxs(f,{children:[e.jsx(o,{children:(l=s.employees)==null?void 0:l.employeeNumber}),e.jsx(o,{children:(n=s.employees)==null?void 0:n.fullName}),e.jsx(o,{children:((r=s.employees)==null?void 0:r.napsaNumber)||"-"}),e.jsx(o,{className:"text-right",children:c(s.grossSalary)}),e.jsx(o,{className:"text-right",children:c(s.napsaEmployee)}),e.jsx(o,{className:"text-right",children:c(s.napsaEmployer)}),e.jsx(o,{className:"text-right font-semibold",children:c(s.napsaEmployee+s.napsaEmployer)})]},s.id)})})]})})]})}),e.jsx(v,{value:"nhima",children:e.jsxs(j,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"NHIMA Contributions Report"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",c(V+F)," (Employee: ",c(V)," + Employer: ",c(F),")"]})]}),e.jsxs(M,{onClick:se,disabled:!(a!=null&&a.length),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]}),e.jsx(y,{children:e.jsxs(R,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Emp #"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"NHIMA Number"}),e.jsx(i,{className:"text-right",children:"Basic Salary"}),e.jsx(i,{className:"text-right",children:"Employee (1%)"}),e.jsx(i,{className:"text-right",children:"Employer (1%)"}),e.jsx(i,{className:"text-right",children:"Total"})]})}),e.jsx(_,{children:a==null?void 0:a.map(s=>{var l,n,r;return e.jsxs(f,{children:[e.jsx(o,{children:(l=s.employees)==null?void 0:l.employeeNumber}),e.jsx(o,{children:(n=s.employees)==null?void 0:n.fullName}),e.jsx(o,{children:((r=s.employees)==null?void 0:r.nhimaNumber)||"-"}),e.jsx(o,{className:"text-right",children:c(s.basicSalary)}),e.jsx(o,{className:"text-right",children:c(s.nhimaEmployee)}),e.jsx(o,{className:"text-right",children:c(s.nhimaEmployer)}),e.jsx(o,{className:"text-right font-semibold",children:c(s.nhimaEmployee+s.nhimaEmployer)})]},s.id)})})]})})]})}),e.jsx(v,{value:"paye",children:e.jsxs(j,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(g,{children:"PAYE Report"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Total PAYE: ",c(q)]})]}),e.jsxs(M,{onClick:ae,disabled:!(a!=null&&a.length),children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]}),e.jsx(y,{children:e.jsxs(R,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Emp #"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"TPIN"}),e.jsx(i,{className:"text-right",children:"Gross Salary"}),e.jsx(i,{className:"text-right",children:"PAYE Amount"})]})}),e.jsx(_,{children:a==null?void 0:a.map(s=>{var l,n,r;return e.jsxs(f,{children:[e.jsx(o,{children:(l=s.employees)==null?void 0:l.employeeNumber}),e.jsx(o,{children:(n=s.employees)==null?void 0:n.fullName}),e.jsx(o,{children:((r=s.employees)==null?void 0:r.tpin)||"-"}),e.jsx(o,{className:"text-right",children:c(s.grossSalary)}),e.jsx(o,{className:"text-right font-semibold",children:c(s.paye)})]},s.id)})})]})})]})})]})]})}export{ye as default};
