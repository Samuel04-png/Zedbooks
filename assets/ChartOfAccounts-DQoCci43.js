import{a7 as de,u as ue,r as b,b as me,d as q,G as V,H as pe,J as he,K as xe,a8 as S,j as e,L as ye,B as u,F as Y,a3 as G,a9 as ge,aa as je,a4 as J,a5 as W,a6 as X,k as m,I as v,V as E,W as F,X as I,Y as k,Z as x,ab as Z,ac as ee,f as L,i as ae,U as fe,g as be,h as ve,$ as M,q as Ne,s as Ce,t as ne,v as y,w as _e,x as g,ad as Ae,ae as we,af as Te,ag as l,O as N,P as j,ah as Se,ai as C,aj as Ee,ak as R,al as Fe,am as Ie}from"./index-BBPTnaZp.js";import{F as ke}from"./filter-DvPjfH1o.js";const _=[{value:"asset",label:"Asset",normalBalance:"Debit"},{value:"liability",label:"Liability",normalBalance:"Credit"},{value:"equity",label:"Equity",normalBalance:"Credit"},{value:"income",label:"Income",normalBalance:"Credit"},{value:"expense",label:"Expense",normalBalance:"Debit"}],De=[{code:1e3,name:"Cash",type:"asset",description:"Money available in bank or cash"},{code:1010,name:"Petty Cash",type:"asset",description:"Small cash for daily needs"},{code:1100,name:"Accounts Receivable",type:"asset",description:"Amount to be received from customers"},{code:1200,name:"Inventory",type:"asset",description:"Stock of goods for sale"},{code:1300,name:"Prepaid Expenses",type:"asset",description:"Advance payments for future expenses"},{code:1500,name:"Fixed Assets",type:"asset",description:"Long-term tangible assets"},{code:1510,name:"Accumulated Depreciation",type:"asset",description:"Total depreciation of fixed assets"},{code:2e3,name:"Accounts Payable",type:"liability",description:"Money owed to suppliers"},{code:2100,name:"Taxes Payable",type:"liability",description:"Taxes due to government"},{code:2200,name:"Loans Payable",type:"liability",description:"Bank or other loans taken"},{code:2300,name:"NAPSA Payable",type:"liability",description:"NAPSA contributions payable"},{code:2310,name:"NHIMA Payable",type:"liability",description:"NHIMA contributions payable"},{code:2320,name:"PAYE Payable",type:"liability",description:"Pay As You Earn tax payable"},{code:3e3,name:"Owner's Equity",type:"equity",description:"Owner's investment in business"},{code:3100,name:"Retained Earnings",type:"equity",description:"Accumulated profits retained"},{code:4001,name:"Sales Revenue",type:"income",description:"Income from sales"},{code:4100,name:"Service Revenue",type:"income",description:"Income from services"},{code:4200,name:"Grant Income",type:"income",description:"Income from grants and donations"},{code:5e3,name:"Cost of Goods Sold",type:"expense",description:"Direct costs of goods sold"},{code:5100,name:"Rent Expense",type:"expense",description:"Monthly office rent"},{code:5200,name:"Office Supplies",type:"expense",description:"Supplies used in office"},{code:5300,name:"Salaries Expense",type:"expense",description:"Employee salaries"},{code:5400,name:"Utilities Expense",type:"expense",description:"Electricity, internet, water bills"},{code:5500,name:"Depreciation Expense",type:"expense",description:"Periodic asset depreciation"},{code:5600,name:"Bank Charges",type:"expense",description:"Bank fees and charges"},{code:5700,name:"Travel Expense",type:"expense",description:"Business travel costs"},{code:5800,name:"Marketing Expense",type:"expense",description:"Advertising and promotion"}],A=d=>{const t=d.toLowerCase();return t==="revenue"?"income":t},H=d=>{const t=A(d),p=_.find(D=>D.value===t);return(p==null?void 0:p.label)||"Expense"},Pe=d=>A(d);function Ue(){const d=de(),{user:t}=ue(),[p,D]=b.useState(""),[P,te]=b.useState("all"),[ce,O]=b.useState(!1),[w,f]=b.useState(null),[n,i]=b.useState({account_code:"",account_name:"",account_type:"",description:"",parent_account_id:""}),{data:s,isLoading:se}=me({queryKey:["chart-of-accounts",t==null?void 0:t.id],queryFn:async()=>{if(!t)return[];const a=await q.getPrimaryMembershipByUser(t.id);if(!(a!=null&&a.companyId))return[];const c=V(j,N.CHART_OF_ACCOUNTS);return(await pe(he(c,xe("companyId","==",a.companyId)))).docs.map(h=>{const o=h.data();return{id:h.id,companyId:String(o.companyId??""),accountCode:Number(o.accountCode??o.account_code??0),accountName:String(o.accountName??o.account_name??""),accountType:Pe(String(o.accountType??o.account_type??"expense")),description:o.description??null,parentAccountId:o.parentAccountId??o.parent_account_id??null,status:String(o.status??(o.isActive===!1?"inactive":"active"))}}).sort((h,o)=>h.accountCode-o.accountCode)},enabled:!!t}),$=S({mutationFn:async a=>{if(!t)throw new Error("Not authenticated");const c=await q.getPrimaryMembershipByUser(t.id);if(!(c!=null&&c.companyId))throw new Error("Company context not found");const r=Number(a.account_code);if(!Number.isFinite(r))throw new Error("Account number must be numeric");await Se(V(j,N.CHART_OF_ACCOUNTS),{companyId:c.companyId,accountCode:r,accountName:a.account_name,accountType:H(a.account_type),description:a.description||null,parentAccountId:a.parent_account_id||null,status:"active",isSystem:!1,createdAt:C(),updatedAt:C()})},onSuccess:()=>{d.invalidateQueries({queryKey:["chart-of-accounts",t==null?void 0:t.id]}),l.success("Account created successfully"),U(),O(!1)},onError:a=>{l.error(`Failed to create account: ${a instanceof Error?a.message:"Unknown error"}`)}}),z=S({mutationFn:async a=>{const c=Number(a.account_code);if(!Number.isFinite(c))throw new Error("Account number must be numeric");await Ee(R(j,N.CHART_OF_ACCOUNTS,a.id),{companyId:a.companyId,accountCode:c,accountName:a.account_name,accountType:H(a.account_type),description:a.description||null,parentAccountId:a.parent_account_id||null,updatedAt:C()},{merge:!0})},onSuccess:()=>{d.invalidateQueries({queryKey:["chart-of-accounts",t==null?void 0:t.id]}),l.success("Account updated successfully"),U(),f(null)},onError:a=>{l.error(`Failed to update account: ${a instanceof Error?a.message:"Unknown error"}`)}}),oe=S({mutationFn:async a=>{await Fe(R(j,N.CHART_OF_ACCOUNTS,a))},onSuccess:()=>{d.invalidateQueries({queryKey:["chart-of-accounts",t==null?void 0:t.id]}),l.success("Account deleted successfully")},onError:a=>{l.error(`Failed to delete account: ${a instanceof Error?a.message:"Unknown error"}`)}}),B=S({mutationFn:async()=>{if(!t)throw new Error("Not authenticated");const a=await q.getPrimaryMembershipByUser(t.id);if(!(a!=null&&a.companyId))throw new Error("Company context not found");const c=Ie(j);De.forEach(r=>{const h=R(j,N.CHART_OF_ACCOUNTS,`${a.companyId}_${r.code}`);c.set(h,{companyId:a.companyId,accountCode:r.code,accountName:r.name,accountType:H(r.type),description:r.description,parentAccountId:null,status:"active",isSystem:!0,createdAt:C(),updatedAt:C()},{merge:!0})}),await c.commit()},onSuccess:()=>{d.invalidateQueries({queryKey:["chart-of-accounts",t==null?void 0:t.id]}),l.success("Default chart of accounts created successfully")},onError:a=>{l.error(`Failed to setup accounts: ${a instanceof Error?a.message:"Unknown error"}`)}}),U=()=>{i({account_code:"",account_name:"",account_type:"",description:"",parent_account_id:""})},re=a=>{f(a),i({account_code:String(a.accountCode),account_name:a.accountName,account_type:a.accountType,description:a.description||"",parent_account_id:a.parentAccountId||""})},ie=a=>{switch(A(a)){case"asset":return{min:1e3,max:19999,label:"1000-19999"};case"liability":return{min:2e3,max:29999,label:"2000-29999"};case"equity":return{min:3e3,max:39999,label:"3000-39999"};case"income":return{min:4e3,max:49999,label:"4000-49999"};case"expense":return{min:5e3,max:99999,label:"5000-99999"};default:return null}},K=()=>{if(!n.account_code||!n.account_name||!n.account_type){l.error("Please fill in all required fields");return}const a=Number(n.account_code);if(!Number.isFinite(a)){l.error("Account number must be numeric");return}const c=ie(n.account_type);if(c&&(a<c.min||a>c.max)){l.error(`Invalid account code for ${n.account_type}. Must be between ${c.label}`);return}w?z.mutate({...n,id:w.id,companyId:w.companyId}):$.mutate(n)},Q=a=>{const c=_.find(r=>r.value===A(a));return(c==null?void 0:c.normalBalance)||"-"},le=a=>{switch(A(a)){case"asset":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"liability":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"equity":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"income":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"expense":return"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";default:return"bg-muted text-muted-foreground"}},T=s==null?void 0:s.filter(a=>{const c=a.accountName.toLowerCase().includes(p.toLowerCase())||String(a.accountCode).includes(p),r=P==="all"||a.accountType===P;return c&&r});return se?e.jsx(ye,{message:"Loading chart of accounts..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Chart of Accounts"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your organization's account structure"})]}),e.jsxs("div",{className:"flex gap-2",children:[(!s||s.length===0)&&e.jsxs(u,{variant:"outline",onClick:()=>B.mutate(),disabled:B.isPending,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Setup Default Accounts"]}),e.jsxs(G,{open:ce,onOpenChange:O,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(u,{onClick:()=>{U(),f(null)},children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Add Account"]})}),e.jsxs(J,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(X,{children:"Add New Account"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"account_code",children:"Account Number *"}),e.jsx(v,{id:"account_code",placeholder:"e.g., 1000",value:n.account_code,onChange:a=>i({...n,account_code:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"account_type",children:"Account Type *"}),e.jsxs(E,{value:n.account_type,onValueChange:a=>i({...n,account_type:a}),children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Select type"})}),e.jsx(k,{children:_.map(a=>e.jsx(x,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"account_name",children:"Account Name *"}),e.jsx(v,{id:"account_name",placeholder:"e.g., Cash on Hand",value:n.account_name,onChange:a=>i({...n,account_name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"parent_account",children:"Parent Account (Optional)"}),e.jsxs(E,{value:n.parent_account_id||"none",onValueChange:a=>i({...n,parent_account_id:a==="none"?"":a}),children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Select parent account"})}),e.jsxs(k,{children:[e.jsx(x,{value:"none",children:"None"}),s==null?void 0:s.filter(a=>a.accountType===n.account_type).map(a=>e.jsxs(x,{value:a.id,children:[a.accountCode," - ",a.accountName]},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(Z,{id:"description",placeholder:"Brief description of this account",value:n.description,onChange:a=>i({...n,description:a.target.value}),rows:3})]}),n.account_type&&e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Normal Balance:"," ",e.jsx("span",{className:"font-medium text-foreground",children:Q(n.account_type)})]})})]}),e.jsxs(ee,{children:[e.jsx(u,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),e.jsx(u,{onClick:K,disabled:$.isPending,children:"Create Account"})]})]})]})]})]}),e.jsx(L,{children:e.jsx(ae,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search accounts...",className:"pl-10",value:p,onChange:a=>D(a.target.value)})]}),e.jsxs(E,{value:P,onValueChange:te,children:[e.jsxs(F,{className:"w-full sm:w-[200px]",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),e.jsx(I,{placeholder:"Filter by type"})]}),e.jsxs(k,{children:[e.jsx(x,{value:"all",children:"All Types"}),_.map(a=>e.jsx(x,{value:a.value,children:a.label},a.value))]})]})]})})}),!T||T.length===0?e.jsx(L,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No accounts found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(s==null?void 0:s.length)===0?"Set up your chart of accounts to start tracking your finances":"No accounts match your search criteria"}),(s==null?void 0:s.length)===0&&e.jsx(u,{onClick:()=>B.mutate(),children:"Setup Default Accounts"})]})}):e.jsxs(L,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ve,{children:"Account List"}),e.jsxs(M,{variant:"secondary",children:[T.length," accounts"]})]})}),e.jsx(ae,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ne,{children:[e.jsx(Ce,{children:e.jsxs(ne,{className:"bg-amber-50 dark:bg-amber-950/20",children:[e.jsx(y,{className:"font-bold",children:"Account Number"}),e.jsx(y,{className:"font-bold",children:"Account Name"}),e.jsx(y,{className:"font-bold",children:"Account Type"}),e.jsx(y,{className:"font-bold",children:"Normal Balance"}),e.jsx(y,{className:"font-bold",children:"Description"}),e.jsx(y,{className:"text-right font-bold",children:"Actions"})]})}),e.jsx(_e,{children:T.map(a=>e.jsxs(ne,{className:"hover:bg-muted/50",children:[e.jsx(g,{className:"font-mono font-medium",children:a.accountCode}),e.jsx(g,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.parentAccountId&&e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"}),a.accountName]})}),e.jsx(g,{children:e.jsx(M,{className:le(a.accountType),variant:"secondary",children:a.accountType})}),e.jsx(g,{children:e.jsx(M,{variant:"outline",children:Q(a.accountType)})}),e.jsx(g,{className:"text-muted-foreground max-w-xs truncate",children:a.description||"-"}),e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>re(a),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>{confirm("Are you sure you want to delete this account?")&&oe.mutate(a.id)},children:e.jsx(Te,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})})})]}),e.jsx(G,{open:!!w,onOpenChange:a=>!a&&f(null),children:e.jsxs(J,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(X,{children:"Edit Account"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_account_code",children:"Account Number *"}),e.jsx(v,{id:"edit_account_code",value:n.account_code,onChange:a=>i({...n,account_code:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_account_type",children:"Account Type *"}),e.jsxs(E,{value:n.account_type,onValueChange:a=>i({...n,account_type:a}),children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Select type"})}),e.jsx(k,{children:_.map(a=>e.jsx(x,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_account_name",children:"Account Name *"}),e.jsx(v,{id:"edit_account_name",value:n.account_name,onChange:a=>i({...n,account_name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_description",children:"Description"}),e.jsx(Z,{id:"edit_description",value:n.description,onChange:a=>i({...n,description:a.target.value}),rows:3})]})]}),e.jsxs(ee,{children:[e.jsx(u,{variant:"outline",onClick:()=>f(null),children:"Cancel"}),e.jsx(u,{onClick:K,disabled:z.isPending,children:"Save Changes"})]})]})})]})}export{Ue as default};
