import{u as Y,r as P,b as q,d as Z,G as M,H as B,J as L,K as O,M as $,j as e,f as S,g as w,a0 as C,e as R,h as v,U as Q,I as X,V as z,W as ee,X as se,Y as te,Z as k,i as ae,a1 as re,q as H,s as U,t as g,v as j,w as V,x as d,A as K,$ as f,B as ne,a2 as ce,a3 as ie,a4 as de,a5 as le,a6 as oe,N,O as E,P as J}from"./index-B36Zt7Jb.js";import{F as me}from"./filter-Xc0E__IK.js";const xe=(t,o)=>{const b=[];for(let m=0;m<t.length;m+=o)b.push(t.slice(m,m+o));return b},he=t=>{if(!t)return"";if(typeof t=="string")return t;if(t instanceof Date)return t.toISOString();if(typeof t=="object"&&t!==null&&"toDate"in t){const o=t;if(typeof o.toDate=="function")return o.toDate().toISOString()}return""};function fe(){const{user:t}=Y(),[o,b]=P.useState(""),[m,G]=P.useState("all"),[r,F]=P.useState(null),{data:c,isLoading:W}=q({queryKey:["journal-entries",t==null?void 0:t.id],queryFn:async()=>{if(!t)return[];const s=await Z.getPrimaryMembershipByUser(t.id);if(!(s!=null&&s.companyId))return[];const l=M(J,E.JOURNAL_ENTRIES);return(await B(L(l,O("companyId","==",s.companyId)))).docs.map(i=>{const a=i.data();return{id:i.id,entryDate:he(a.entryDate??a.entry_date),referenceNumber:a.referenceNumber??a.reference_number??null,description:a.description??null,isPosted:!!(a.isPosted??a.is_posted??!1),isDeleted:!!(a.isDeleted??a.is_deleted??!1),isLocked:!!(a.isLocked??a.is_locked??!1)}}).filter(i=>!i.isDeleted).sort((i,a)=>String(a.entryDate).localeCompare(String(i.entryDate)))},enabled:!!t}),{data:x}=q({queryKey:["journal-entry-lines",r==null?void 0:r.id],queryFn:async()=>{if(!r)return[];const s=M(J,E.JOURNAL_LINES),h=(await B(L(s,O("entryId","==",r.id)))).docs.map(u=>{const n=u.data();return{id:u.id,entryId:String(n.entryId??n.journalEntryId??n.journal_entry_id??""),accountId:String(n.accountId??n.account_id??""),description:n.description??null,debitAmount:Number(n.debit??n.debitAmount??n.debit_amount??0),creditAmount:Number(n.credit??n.creditAmount??n.credit_amount??0)}}),i=Array.from(new Set(h.map(u=>u.accountId).filter(Boolean))),a=new Map;if(i.length>0){const u=M(J,E.CHART_OF_ACCOUNTS),n=xe(i,30);(await Promise.all(n.map(T=>B(L(u,O($(),"in",T)))))).forEach(T=>{T.docs.forEach(_=>{const p=_.data();a.set(_.id,{id:_.id,accountCode:String(p.accountCode??p.account_code??""),accountName:String(p.accountName??p.account_name??""),accountType:String(p.accountType??p.account_type??"")})})})}return h.map(u=>({...u,account:a.get(u.accountId)??null}))},enabled:!!(r!=null&&r.id)}),I=c==null?void 0:c.filter(s=>{var i,a;const l=((i=s.referenceNumber)==null?void 0:i.toLowerCase().includes(o.toLowerCase()))||((a=s.description)==null?void 0:a.toLowerCase().includes(o.toLowerCase())),h=m==="all"||m==="posted"&&s.isPosted||m==="draft"&&!s.isPosted;return!!(l||!o&&h)&&h}),y=(x==null?void 0:x.reduce((s,l)=>s+l.debitAmount,0))||0,D=(x==null?void 0:x.reduce((s,l)=>s+l.creditAmount,0))||0,A={total:(c==null?void 0:c.length)||0,posted:(c==null?void 0:c.filter(s=>s.isPosted).length)||0,draft:(c==null?void 0:c.filter(s=>!s.isPosted).length)||0};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Journal Entries"}),e.jsx("p",{className:"text-muted-foreground",children:"View General Ledger journal entries and postings"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(S,{children:e.jsxs(w,{className:"pb-2",children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Total Entries"]}),e.jsx(v,{className:"text-2xl",children:A.total})]})}),e.jsx(S,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(C,{children:"Posted"}),e.jsx(v,{className:"text-2xl text-green-600",children:A.posted})]})}),e.jsx(S,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(C,{children:"Draft"}),e.jsx(v,{className:"text-2xl text-amber-600",children:A.draft})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Search by reference or description...",value:o,onChange:s=>b(s.target.value),className:"pl-9"})]}),e.jsxs(z,{value:m,onValueChange:G,children:[e.jsxs(ee,{className:"w-[150px]",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx(se,{placeholder:"Status"})]}),e.jsxs(te,{children:[e.jsx(k,{value:"all",children:"All Status"}),e.jsx(k,{value:"posted",children:"Posted"}),e.jsx(k,{value:"draft",children:"Draft"})]})]})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(v,{children:"Journal Entries"}),e.jsx(C,{children:"Double-entry accounting records"})]}),e.jsx(ae,{children:W?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):I&&I.length>0?e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(H,{children:[e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Reference"}),e.jsx(j,{children:"Description"}),e.jsx(j,{children:"Status"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(V,{children:I.map(s=>e.jsxs(g,{children:[e.jsx(d,{children:s.entryDate?K(new Date(s.entryDate),"dd MMM yyyy"):"-"}),e.jsx(d,{className:"font-mono",children:s.referenceNumber||"-"}),e.jsx(d,{children:s.description||"-"}),e.jsx(d,{children:s.isPosted?e.jsx(f,{className:"bg-green-600",children:"Posted"}):e.jsx(f,{variant:"outline",className:"text-amber-600 border-amber-600",children:"Draft"})}),e.jsx(d,{className:"text-right",children:e.jsxs(ne,{variant:"ghost",size:"sm",onClick:()=>F(s),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"View"]})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No journal entries found"}),e.jsx("p",{className:"text-sm",children:"Journal entries are created automatically from transactions"})]})})]}),e.jsx(ie,{open:!!r,onOpenChange:()=>F(null),children:e.jsxs(de,{className:"max-w-3xl",children:[e.jsx(le,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Journal Entry Details"]})}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reference"}),e.jsx("p",{className:"font-mono font-medium",children:r.referenceNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-medium",children:r.entryDate?K(new Date(r.entryDate),"dd MMM yyyy"):"-"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"font-medium",children:r.description||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),r.isPosted?e.jsx(f,{className:"bg-green-600",children:"Posted"}):e.jsx(f,{variant:"outline",className:"text-amber-600 border-amber-600",children:"Draft"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Locked"}),r.isLocked?e.jsx(f,{variant:"secondary",children:"Yes"}):e.jsx(f,{variant:"outline",children:"No"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Entry Lines"}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(H,{children:[e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(j,{children:"Account"}),e.jsx(j,{children:"Description"}),e.jsx(j,{className:"text-right",children:"Debit"}),e.jsx(j,{className:"text-right",children:"Credit"})]})}),e.jsxs(V,{children:[x==null?void 0:x.map(s=>{var l,h;return e.jsxs(g,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((l=s.account)==null?void 0:l.accountName)||"-"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:((h=s.account)==null?void 0:h.accountCode)||""})]})}),e.jsx(d,{children:s.description||"-"}),e.jsx(d,{className:"text-right",children:s.debitAmount>0?N(s.debitAmount):"-"}),e.jsx(d,{className:"text-right",children:s.creditAmount>0?N(s.creditAmount):"-"})]},s.id)}),e.jsxs(g,{className:"bg-muted/50 font-medium",children:[e.jsx(d,{colSpan:2,className:"text-right",children:"Totals"}),e.jsx(d,{className:"text-right",children:N(y)}),e.jsx(d,{className:"text-right",children:N(D)})]})]})]})}),e.jsx("div",{className:`mt-4 p-3 rounded-lg ${Math.abs(y-D)<.01?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:Math.abs(y-D)<.01?e.jsx("p",{className:"text-green-700 text-sm",children:"Entry is balanced (Debits = Credits)"}):e.jsxs("p",{className:"text-red-700 text-sm",children:["Entry is unbalanced - Difference: ",N(Math.abs(y-D))]})})]})]})]})})]})}export{fe as default};
